<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>All Users</title>
  <link rel="stylesheet" href="/stylesheets/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-zinc-900 text-white min-h-screen p-10">

  <!-- Navigation -->
  <div class="flex justify-between items-center mb-6">
    <a href="/" class="text-cyan-400 hover:text-cyan-200 underline underline-offset-2 transition">← Back To Home</a>
    <button onclick="exportCSV()" class="bg-cyan-500 text-black px-4 py-2 rounded-lg font-medium hover:bg-cyan-600 transition duration-300">⬇ Export CSV</button>
  </div>

  <!-- Heading -->
  <h1 class="text-4xl font-bold tracking-tight mb-6 hover:text-cyan-300 transition duration-300">All Users</h1>

  <!-- Search -->
  <input 
    id="searchInput" 
    type="text" 
    placeholder="Search by name or email..." 
    class="w-full max-w-xl mb-8 px-5 py-3 bg-zinc-800 border border-zinc-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-cyan-400 transition-all duration-300 text-white"
    onkeyup="filterUsers()"
  />

  <!-- User Cards -->
  <div id="usersContainer" class="flex flex-wrap gap-6">
    <% if (users.length > 0) { %>
      <% users.forEach(function(user){ %>
        <div class="userCard bg-zinc-800 w-72 p-4 rounded-xl shadow-md hover:shadow-lg hover:scale-105 transition-all duration-300" data-name="<%= user.name.toLowerCase() %>" data-email="<%= user.email.toLowerCase() %>">
          <div class="w-full h-48 rounded-lg bg-zinc-700 overflow-hidden mb-3">
            <img src="<%= user.image %>" alt="User Image" class="w-full h-full object-cover object-top transition-transform duration-500 hover:scale-105" />
          </div>
          <h3 class="text-xl font-semibold tracking-tight mb-1"><%= user.name %></h3>
          <h5 class="text-sm text-zinc-400 truncate"><%= user.email %></h5>
          <div class="flex justify-between mt-4">
            <a href="/edit/<%= user._id %>" class="text-blue-400 hover:text-blue-300 font-medium transition duration-200 hover:underline">Edit</a>
            <a href="/delete/<%= user._id %>" onclick="return confirmDelete()" class="text-red-500 hover:text-red-400 font-medium transition duration-200 hover:underline">Delete</a>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="w-full text-center text-zinc-500 text-lg mt-10 animate-pulse">No users found yet. Add some users to get started.</div>
    <% } %>
  </div>

  <!-- Scripts -->
  <script>
    function confirmDelete() {
      return confirm("Are you sure you want to delete this user?");
    }

    function filterUsers() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const users = document.querySelectorAll('.userCard');

      users.forEach(card => {
        const name = card.dataset.name;
        const email = card.dataset.email;
        card.style.display = (name.includes(query) || email.includes(query)) ? "block" : "none";
      });
    }

    function exportCSV() {
      const rows = [["Name", "Email", "Image"]];
      const cards = document.querySelectorAll(".userCard");

      cards.forEach(card => {
        if (card.style.display !== "none") {
          const name = card.querySelector("h3").innerText;
          const email = card.querySelector("h5").innerText;
          const img = card.querySelector("img").src;
          rows.push([name, email, img]);
        }
      });

      const csvContent = rows.map(row => row.map(value => `"${value}"`).join(",")).join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "users.csv";
      link.click();
    }
  </script>
</body>
</html>
